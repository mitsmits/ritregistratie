<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ritregistratie</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide icons as inline SVG components
        const MapPin = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const Car = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"></path>
                <circle cx="7" cy="17" r="2"></circle>
                <path d="M9 17h6"></path>
                <circle cx="17" cy="17" r="2"></circle>
            </svg>
        );

        const Upload = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Settings = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m-6-6h6m6 0h6m-6-6 4.22-4.22m-8.44 0L3.78 5.78m0 12.44L7.56 14.44m8.88 0 3.78 3.78"></path>
            </svg>
        );

        const Navigation = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
            </svg>
        );

        const CheckCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );

        const AlertCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        function AutoCommuteTracker() {
            const [trackingState, setTrackingState] = useState('idle');
            const [trips, setTrips] = useState([]);
            const [currentPosition, setCurrentPosition] = useState(null);
            const [distance, setDistance] = useState(0);
            const [error, setError] = useState(null);
            const [uploadStatus, setUploadStatus] = useState(null);
            const [detectionEnabled, setDetectionEnabled] = useState(false);
            
            const [ritnummer, setRitnummer] = useState('');
            const [beginstand, setBeginstand] = useState('');
            const [adresVertrek, setAdresVertrek] = useState('');
            const [adresAankomst, setAdresAankomst] = useState('');
            const [isZakelijk, setIsZakelijk] = useState(true);
            const [priveKm, setPriveKm] = useState('');
            const [extraUitleg, setExtraUitleg] = useState('');
            const [kenteken, setKenteken] = useState('');
            
            const [showSettings, setShowSettings] = useState(false);
            const [googleClientId, setGoogleClientId] = useState('');
            const [spreadsheetId, setSpreadsheetId] = useState('');
            const [defaultKenteken, setDefaultKenteken] = useState('');
            const [defaultVertrekAdres, setDefaultVertrekAdres] = useState('');
            const [defaultAankomstAdres, setDefaultAankomstAdres] = useState('');
            const [autoBeginstand, setAutoBeginstand] = useState('');
            const [speedThreshold, setSpeedThreshold] = useState(5);
            
            const watchIdRef = useRef(null);
            const startTimeRef = useRef(null);
            const positionsRef = useRef([]);
            const accessTokenRef = useRef(null);
            const lastPositionRef = useRef(null);
            const stoppedTimerRef = useRef(null);

            useEffect(() => {
                const savedTrips = localStorage.getItem('commuteTrips');
                if (savedTrips) {
                    setTrips(JSON.parse(savedTrips));
                }
                
                const savedSettings = localStorage.getItem('commuteSettings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    setGoogleClientId(settings.googleClientId || '');
                    setSpreadsheetId(settings.spreadsheetId || '');
                    setDefaultKenteken(settings.defaultKenteken || '');
                    setDefaultVertrekAdres(settings.defaultVertrekAdres || '');
                    setDefaultAankomstAdres(settings.defaultAankomstAdres || '');
                    setAutoBeginstand(settings.autoBeginstand || '');
                    setSpeedThreshold(settings.speedThreshold || 5);
                    setKenteken(settings.defaultKenteken || '');
                }

                if (savedTrips) {
                    const parsedTrips = JSON.parse(savedTrips);
                    if (parsedTrips.length > 0) {
                        const lastTrip = parsedTrips[parsedTrips.length - 1];
                        if (lastTrip && lastTrip.ritnummer) {
                            setRitnummer(String(parseInt(lastTrip.ritnummer) + 1));
                        } else {
                            setRitnummer('1');
                        }
                        if (lastTrip && lastTrip.eindstand) {
                            setBeginstand(lastTrip.eindstand);
                        }
                    } else {
                        setRitnummer('1');
                        setBeginstand(autoBeginstand);
                    }
                } else {
                    setRitnummer('1');
                    setBeginstand(autoBeginstand);
                }

                if (!navigator.geolocation) {
                    setError('Geolocatie wordt niet ondersteund door je browser');
                }

                return () => {
                    if (watchIdRef.current) {
                        navigator.geolocation.clearWatch(watchIdRef.current);
                    }
                    if (stoppedTimerRef.current) {
                        clearTimeout(stoppedTimerRef.current);
                    }
                };
            }, []);

            const calculateDistance = (lat1, lon1, lat2, lon2) => {
                const R = 6371;
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLon = (lon2 - lon1) * Math.PI / 180;
                const a = 
                    Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            };

            const calculateSpeed = (lat1, lon1, time1, lat2, lon2, time2) => {
                const distance = calculateDistance(lat1, lon1, lat2, lon2);
                const timeDiff = (time2 - time1) / 1000 / 3600;
                return distance / timeDiff;
            };

            const startMovementDetection = () => {
                setDetectionEnabled(true);
                setTrackingState('detecting');
                setError(null);

                watchIdRef.current = navigator.geolocation.watchPosition(
                    (position) => {
                        const newPos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            timestamp: Date.now(),
                            accuracy: position.coords.accuracy,
                            speed: position.coords.speed
                        };

                        setCurrentPosition(newPos);

                        if (lastPositionRef.current && trackingState === 'detecting') {
                            const speed = calculateSpeed(
                                lastPositionRef.current.lat,
                                lastPositionRef.current.lng,
                                lastPositionRef.current.timestamp,
                                newPos.lat,
                                newPos.lng,
                                newPos.timestamp
                            );

                            if (speed > speedThreshold) {
                                startAutomaticTracking();
                            }
                        }

                        if (trackingState === 'tracking' && lastPositionRef.current) {
                            const speed = calculateSpeed(
                                lastPositionRef.current.lat,
                                lastPositionRef.current.lng,
                                lastPositionRef.current.timestamp,
                                newPos.lat,
                                newPos.lng,
                                newPos.timestamp
                            );

                            if (speed < speedThreshold) {
                                if (!stoppedTimerRef.current) {
                                    stoppedTimerRef.current = setTimeout(() => {
                                        setTrackingState('finishing');
                                    }, 120000);
                                }
                            } else {
                                if (stoppedTimerRef.current) {
                                    clearTimeout(stoppedTimerRef.current);
                                    stoppedTimerRef.current = null;
                                }
                            }
                        }

                        lastPositionRef.current = newPos;

                        if (trackingState === 'tracking') {
                            if (positionsRef.current.length > 0) {
                                const lastPos = positionsRef.current[positionsRef.current.length - 1];
                                const dist = calculateDistance(
                                    lastPos.lat, lastPos.lng,
                                    newPos.lat, newPos.lng
                                );
                                setDistance(prev => prev + dist);
                            }
                            positionsRef.current.push(newPos);
                        }
                    },
                    (err) => {
                        setError('Kon locatie niet ophalen: ' + err.message);
                    },
                    {
                        enableHighAccuracy: true,
                        maximumAge: 0,
                        timeout: 10000
                    }
                );
            };

            const startAutomaticTracking = () => {
                console.log('Auto-detected movement - starting tracking');
                setTrackingState('tracking');
                startTimeRef.current = new Date();
                positionsRef.current = [];
                setDistance(0);
                setAdresVertrek(defaultVertrekAdres);
            };

            const stopMovementDetection = () => {
                if (watchIdRef.current) {
                    navigator.geolocation.clearWatch(watchIdRef.current);
                    watchIdRef.current = null;
                }
                if (stoppedTimerRef.current) {
                    clearTimeout(stoppedTimerRef.current);
                    stoppedTimerRef.current = null;
                }
                setDetectionEnabled(false);
                setTrackingState('idle');
                lastPositionRef.current = null;
            };

            const authenticateGoogle = async () => {
                return new Promise((resolve, reject) => {
                    if (!googleClientId) {
                        reject(new Error('Google Client ID niet ingesteld'));
                        return;
                    }

                    const client = google.accounts.oauth2.initTokenClient({
                        client_id: googleClientId,
                        scope: 'https://www.googleapis.com/auth/spreadsheets',
                        callback: (response) => {
                            if (response.access_token) {
                                accessTokenRef.current = response.access_token;
                                resolve(response.access_token);
                            } else {
                                reject(new Error('Geen toegang gekregen'));
                            }
                        },
                    });
                    
                    client.requestAccessToken();
                });
            };

            const uploadToGoogleSheets = async (trip) => {
                try {
                    setUploadStatus('Uploaden naar Google Sheets...');

                    if (!spreadsheetId) {
                        throw new Error('Google Spreadsheet ID niet ingesteld');
                    }

                    let token = accessTokenRef.current;
                    if (!token) {
                        token = await authenticateGoogle();
                    }

                    // Prepare row data
                    const rowData = [
                        trip.datum,
                        trip.ritnummer,
                        trip.beginstand,
                        trip.adresVertrek,
                        trip.eindstand,
                        trip.adresAankomst,
                        trip.type,
                        trip.priveKm || '',
                        trip.extraUitleg || '',
                        trip.kenteken
                    ];

                    // Append to Google Sheets
                    const response = await fetch(
                        `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/Sheet1!A:J:append?valueInputOption=USER_ENTERED`,
                        {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                values: [rowData]
                            })
                        }
                    );

                    if (response.ok) {
                        setUploadStatus('âœ“ Succesvol toegevoegd aan Google Sheets!');
                        setTimeout(() => setUploadStatus(null), 3000);
                        return true;
                    } else {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'Upload gefaald');
                    }
                } catch (err) {
                    setUploadStatus('âœ— Upload mislukt: ' + err.message);
                    setTimeout(() => setUploadStatus(null), 5000);
                    return false;
                }
            };

            const completeTrip = async () => {
                if (!adresAankomst || !kenteken) {
                    setError('Vul minimaal aankomstadres en kenteken in');
                    return;
                }

                if (watchIdRef.current) {
                    navigator.geolocation.clearWatch(watchIdRef.current);
                    watchIdRef.current = null;
                }

                const endTime = new Date();
                const calculatedEindstand = (parseFloat(beginstand || 0) + distance).toFixed(1);

                const trip = {
                    id: Date.now(),
                    datum: startTimeRef.current.toISOString().split('T')[0],
                    ritnummer: ritnummer,
                    beginstand: beginstand,
                    adresVertrek: adresVertrek || 'Onbekend',
                    eindstand: calculatedEindstand,
                    adresAankomst: adresAankomst,
                    type: isZakelijk ? 'Zakelijk' : 'Prive',
                    priveKm: priveKm,
                    extraUitleg: extraUitleg,
                    kenteken: kenteken,
                    startTime: startTimeRef.current.toISOString(),
                    endTime: endTime.toISOString(),
                    distance: distance.toFixed(2),
                    positions: positionsRef.current
                };

                const updatedTrips = [...trips, trip];
                setTrips(updatedTrips);
                localStorage.setItem('commuteTrips', JSON.stringify(updatedTrips));

                await uploadToGoogleSheets(trip);

                setRitnummer(String(parseInt(ritnummer) + 1));
                setBeginstand(calculatedEindstand);
                setAdresVertrek(defaultVertrekAdres);
                setAdresAankomst('');
                setExtraUitleg('');
                setPriveKm('');
                setIsZakelijk(true);
                positionsRef.current = [];
                setDistance(0);
                setTrackingState('idle');
                setDetectionEnabled(false);
                lastPositionRef.current = null;
            };

            const cancelTrip = () => {
                if (window.confirm('Weet je zeker dat je deze rit wilt annuleren?')) {
                    stopMovementDetection();
                    positionsRef.current = [];
                    setDistance(0);
                    setAdresVertrek('');
                    setAdresAankomst('');
                    setExtraUitleg('');
                }
            };

            const saveSettings = () => {
                const settings = {
                    googleClientId,
                    spreadsheetId,
                    defaultKenteken,
                    defaultVertrekAdres,
                    defaultAankomstAdres,
                    autoBeginstand,
                    speedThreshold
                };
                localStorage.setItem('commuteSettings', JSON.stringify(settings));
                setKenteken(defaultKenteken);
                setShowSettings(false);
                alert('Instellingen opgeslagen!');
            };

            const formatDate = (isoString) => {
                return new Date(isoString).toLocaleDateString('nl-NL');
            };

            const formatTime = (isoString) => {
                return new Date(isoString).toLocaleTimeString('nl-NL', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            if (showSettings) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-xl p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">Instellingen</h2>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Google Client ID
                                        </label>
                                        <input
                                            type="text"
                                            value={googleClientId}
                                            onChange={(e) => setGoogleClientId(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="Jouw Google OAuth Client ID"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Google Spreadsheet ID
                                        </label>
                                        <input
                                            type="text"
                                            value={spreadsheetId}
                                            onChange={(e) => setSpreadsheetId(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="ID uit de Google Sheets URL"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">
                                            Vind dit in de URL van je spreadsheet tussen /d/ en /edit
                                        </p>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Standaard Kenteken
                                        </label>
                                        <input
                                            type="text"
                                            value={defaultKenteken}
                                            onChange={(e) => setDefaultKenteken(e.target.value.toUpperCase())}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="XX-XX-XX"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Standaard Vertrekadres
                                        </label>
                                        <input
                                            type="text"
                                            value={defaultVertrekAdres}
                                            onChange={(e) => setDefaultVertrekAdres(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="Bijv. Thuis"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Standaard Aankomstadres
                                        </label>
                                        <input
                                            type="text"
                                            value={defaultAankomstAdres}
                                            onChange={(e) => setDefaultAankomstAdres(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="Bijv. Werk"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Start Kilometerstand
                                        </label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={autoBeginstand}
                                            onChange={(e) => setAutoBeginstand(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="0"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Snelheidsdrempel (km/h)
                                        </label>
                                        <input
                                            type="number"
                                            value={speedThreshold}
                                            onChange={(e) => setSpeedThreshold(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="5"
                                        />
                                    </div>
                                </div>

                                <div className="flex gap-3 mt-6">
                                    <button
                                        onClick={saveSettings}
                                        className="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700"
                                    >
                                        Opslaan
                                    </button>
                                    <button
                                        onClick={() => setShowSettings(false)}
                                        className="bg-gray-200 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-300"
                                    >
                                        Annuleren
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-2xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <div className="flex items-center justify-between mb-6">
                                <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-2">
                                    <Car />
                                    Auto Ritregistratie
                                </h1>
                                <button
                                    onClick={() => setShowSettings(true)}
                                    className="text-blue-600 hover:text-blue-700"
                                >
                                    <Settings />
                                </button>
                            </div>

                            {error && (
                                <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 flex items-center gap-2">
                                    <AlertCircle />
                                    {error}
                                </div>
                            )}

                            {uploadStatus && (
                                <div className={`px-4 py-3 rounded-lg mb-4 ${
                                    uploadStatus.includes('âœ“') ? 'bg-green-50 border border-green-200 text-green-700' : 
                                    uploadStatus.includes('âœ—') ? 'bg-red-50 border border-red-200 text-red-700' :
                                    'bg-blue-50 border border-blue-200 text-blue-700'
                                }`}>
                                    {uploadStatus}
                                </div>
                            )}

                            <div className={`rounded-xl p-6 mb-6 ${
                                trackingState === 'detecting' ? 'bg-gradient-to-r from-yellow-400 to-orange-500' :
                                trackingState === 'tracking' ? 'bg-gradient-to-r from-green-400 to-green-600' :
                                trackingState === 'finishing' ? 'bg-gradient-to-r from-blue-400 to-blue-600' :
                                'bg-gradient-to-r from-gray-400 to-gray-600'
                            } text-white`}>
                                <div className="flex items-center justify-between mb-4">
                                    <div className="flex items-center gap-2">
                                        {trackingState === 'idle' && <MapPin />}
                                        {trackingState !== 'idle' && <Navigation />}
                                        <span className="text-sm opacity-90">Status</span>
                                    </div>
                                    <span className="px-3 py-1 rounded-full text-sm font-medium bg-white bg-opacity-30">
                                        {trackingState === 'detecting' && 'Wachtend op beweging...'}
                                        {trackingState === 'tracking' && 'Aan het rijden'}
                                        {trackingState === 'finishing' && 'Rit afronden'}
                                        {trackingState === 'idle' && 'Niet actief'}
                                    </span>
                                </div>

                                {trackingState === 'tracking' && (
                                    <div className="space-y-2">
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm opacity-90">Afgelegde afstand</span>
                                            <span className="text-2xl font-bold">{distance.toFixed(2)} km</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm opacity-90">GPS Punten</span>
                                            <span className="text-xl font-semibold">{positionsRef.current.length}</span>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {trackingState === 'finishing' && (
                                <div className="bg-blue-50 rounded-lg p-4 mb-6">
                                    <h3 className="font-semibold text-lg mb-4 text-gray-800">Rit afronden</h3>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Kenteken *</label>
                                            <input
                                                type="text"
                                                value={kenteken}
                                                onChange={(e) => setKenteken(e.target.value.toUpperCase())}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                                placeholder="XX-XX-XX"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Adres aankomst *</label>
                                            <input
                                                type="text"
                                                value={adresAankomst}
                                                onChange={(e) => setAdresAankomst(e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                                placeholder="Werk, Thuis, etc."
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Type rit</label>
                                                <select
                                                    value={isZakelijk ? 'zakelijk' : 'prive'}
                                                    onChange={(e) => setIsZakelijk(e.target.value === 'zakelijk')}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                                >
                                                    <option value="zakelijk">Zakelijk</option>
                                                    <option value="prive">PrivÃ©</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">PrivÃ© KM's</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={priveKm}
                                                    onChange={(e) => setPriveKm(e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                                    placeholder="0.0"
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Extra uitleg</label>
                                            <textarea
                                                value={extraUitleg}
                                                onChange={(e) => setExtraUitleg(e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                                rows="2"
                                                placeholder="Optioneel..."
                                            />
                                        </div>

                                        <div className="flex gap-3 mt-4">
                                            <button
                                                onClick={completeTrip}
                                                className="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 flex items-center justify-center gap-2"
                                            >
                                                <Upload />
                                                Opslaan & Uploaden
                                            </button>
                                            <button
                                                onClick={cancelTrip}
                                                className="bg-red-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-700"
                                            >
                                                Annuleren
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {trackingState === 'idle' && (
                                <button
                                    onClick={startMovementDetection}
                                    className="w-full bg-blue-600 text-white py-4 px-6 rounded-lg font-semibold hover:bg-blue-700 flex items-center justify-center gap-2 text-lg"
                                >
                                    <Navigation />
                                    Start Detectie
                                </button>
                            )}

                            {(trackingState === 'detecting' || trackingState === 'tracking') && (
                                <button
                                    onClick={() => setTrackingState('finishing')}
                                    className="w-full bg-orange-600 text-white py-4 px-6 rounded-lg font-semibold hover:bg-orange-700 flex items-center justify-center gap-2 text-lg"
                                >
                                    <CheckCircle />
                                    Rit Afronden
                                </button>
                            )}

                            <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                                <div className="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span className="text-gray-600">Ritnummer:</span>
                                        <span className="ml-2 font-semibold">{ritnummer}</span>
                                    </div>
                                    <div>
                                        <span className="text-gray-600">Beginstand:</span>
                                        <span className="ml-2 font-semibold">{beginstand} km</span>
                                    </div>
                                </div>
                            </div>

                            <div className="mt-6">
                                <h2 className="text-xl font-semibold text-gray-800 mb-4">
                                    Recente Ritten ({trips.length})
                                </h2>
                                
                                {trips.length === 0 ? (
                                    <div className="text-center py-8 text-gray-500">
                                        <Car />
                                        <p>Nog geen ritten geregistreerd</p>
                                    </div>
                                ) : (
                                    <div className="space-y-3 max-h-96 overflow-y-auto">
                                        {trips.slice().reverse().map((trip) => (
                                            <div key={trip.id} className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div>
                                                        <div className="font-semibold text-gray-800">
                                                            Rit #{trip.ritnummer} - {formatDate(trip.datum)}
                                                        </div>
                                                        <div className="text-sm text-gray-600">
                                                            {trip.adresVertrek} â†’ {trip.adresAankomst}
                                                        </div>
                                                        <div className="text-xs text-gray-500 mt-1">
                                                            {trip.kenteken} | {trip.type}
                                                        </div>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-lg font-bold text-blue-600">
                                                            {trip.distance} km
                                                        </div>
                                                        <div className="text-sm text-gray-600">
                                                            {trip.beginstand} â†’ {trip.eindstand}
                                                        </div>
                                                    </div>
                                                </div>
                                                {trip.extraUitleg && (
                                                    <div className="text-xs text-gray-600 mt-2 italic">
                                                        {trip.extraUitleg}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="bg-white rounded-lg p-4 text-sm text-gray-600">
                            <h3 className="font-semibold mb-2">ðŸ’¡ Hoe het werkt:</h3>
                            <ul className="space-y-1 list-disc list-inside">
                                <li>Klik op "Start Detectie"</li>
                                <li>App detecteert automatisch wanneer je begint te rijden</li>
                                <li>Tracking stopt automatisch na 2 minuten stilstand</li>
                                <li>Vul gegevens in en upload naar Google Drive</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AutoCommuteTracker />);
    </script>
</body>
</html>
